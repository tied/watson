(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{190:function(e,t,a){e.exports=a(396)},197:function(e,t,a){},200:function(e,t,a){},201:function(e,t,a){},202:function(e,t,a){},203:function(e,t,a){},204:function(e,t,a){},205:function(e,t,a){},212:function(e,t,a){},213:function(e,t,a){},392:function(e,t,a){},393:function(e,t,a){},394:function(e,t,a){},395:function(e,t,a){},396:function(e,t,a){"use strict";a.r(t);var n,r=a(1),i=a.n(r),l=a(39),o=a.n(l),c=a(14),s=a(17),u=a(33),h=(a(197),a(3)),m=a(7),d=a(9),p=a(8),f=a(10),g=a(49),v=a.n(g),E=a(90),y=a(91),w=a(92),b=a.n(w),k=a(148),O=a.n(k),T=b.a.createInstance({name:"lastUsed"}),C=b.a.createInstance({name:"threadDumps"}),D=function(){var e=Object(E.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==n){e.next=2;break}return e.abrupt("return",N(t));case 2:return e.abrupt("return",n);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),S=function(e){n=e;var t=Object(y.b)(n),a=O.a.hash(t);return C.setItem(a,t),a},j=function(){n=[]};function N(e){return F.apply(this,arguments)}function F(){return(F=Object(E.a)(v.a.mark(function e(t){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.getItem(t);case 2:return(a=e.sent)&&T.setItem(t,(new Date).valueOf()),n=a?Object(y.a)(a):[],e.abrupt("return",n);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var x=function(e){return function(t){function a(e){var t;Object(h.a)(this,a),(t=Object(d.a)(this,Object(p.a)(a).call(this,e))).state={promisePending:!0,threadDumps:[]},t.scrollToTop=function(){var e=document.getElementById("content");e&&(e.scrollTop=0)};var n=e.match.params.key;return D(n).then(function(t){return 0===t.length&&e.history.push("/"),t}).then(function(e){t.setState({threadDumps:e,promisePending:!1})}),t}return Object(f.a)(a,t),Object(m.a)(a,[{key:"componentDidMount",value:function(){this.scrollToTop()}},{key:"render",value:function(){return this.state.promisePending?i.a.createElement("h4",{id:"centered"},"Loading data from cache..."):i.a.createElement(e,Object.assign({threadDumps:this.state.threadDumps},this.props))}}]),a}(i.a.Component)},A=(a(200),a(168));function M(e){var t=new Map;return e.forEach(function(e,a){e.threads.forEach(function(e){var n=t.get(e.id);n||(n=new Map),n.set(a,e),t.set(e.id,n)})}),Array.from(t.values()).sort(function(e,t){return I(e).localeCompare(I(t))})}var I=function(e){var t=!0,a=!1,n=void 0;try{for(var r,i=e[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var l=r.value,o=Object(A.a)(l,2)[1];if(o)return o.name}}catch(c){a=!0,n=c}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}return""},U=a(41),P=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).PAGE_NAME="Unknown Page",a.handleFilterChange=function(e){var t=e.target.name,n=e.target.checked,r=Object(U.a)({},t,n);c.b.event({action:"".concat(a.PAGE_NAME," settings changed"),category:"Navigation",label:"Filter ".concat(t," changed to ").concat(n)}),a.setState(r)},a.handleIntegerChange=function(e){var t=e.target.name,n=parseInt(e.target.value?e.target.value:"0",10),r=Object(U.a)({},t,n>0?n:0);c.b.event({action:"".concat(a.PAGE_NAME," settings changed"),category:"Navigation",label:"Number ".concat(t," changed to ").concat(n)}),a.setState(r)},a.handleRegExpChange=function(e){var t=e.target.name,n=e.target.value,r=Object(U.a)({},t,n);c.b.event({action:"".concat(a.PAGE_NAME," settings changed"),category:"Navigation",label:"RegExp ".concat(t," changed to ").concat(n)}),a.setState(r)},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return null}}]),t}(i.a.PureComponent);P.NO_CPU_INFOS="You need to load the <i>cpu_info</i> files to see this data.",P.NO_CPU_AND_THREADS_PAIR="You need to load matching <i>cpu_info</i> and <i>jira_threads</i> files to see this data.",P.NO_THREAD_DUMPS="You need to load the <i>thread_dump</i> files to see this data.",P.N0_THREADS_MATCHING="No threads match the selected criteria.",P.N0_MONITORS_MATCHING="No monitors match the selected criteria.";var _,L=function e(t,a){Object(h.a)(this,e),this.calculatedValue=void 0,this.threadOccurences=void 0,this.calculatedValue=t,this.threadOccurences=a},W=function e(t,a,n){Object(h.a)(this,e),this.id=void 0,this.name=void 0,this.status=void 0,this.cpuUsage=0,this.runningFor=void 0,this.lockWaitingFor=null,this.locksHeld=[],this.classicalLocksHeld=[],this.stackTrace=[],this.matchingFilter=!1,this.epoch=void 0,this.id=t,this.name=a,this.epoch=n};W.getFormattedTime=function(e){return e.epoch?new Date(e.epoch).toLocaleTimeString():""},function(e){e.RUNNABLE="runnable",e.BLOCKED="blocked",e.WAITING="waiting",e.TIMED_WAITING="timed-waiting",e.UNKNOWN="unknown"}(_||(_={}));var R=_,H=(a(201),function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e))).externalWindow=void 0,a.container=void 0,a.windowFeatures="width=960,height=530,titlebar=0,menubar=0,location=0,toolbar=0,status=0",a.closeAllExternalWindows=function(){var e=!0,a=!1,n=void 0;try{for(var r,i=t.windows[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var l=r.value;l&&!l.closed&&l.close()}}catch(o){a=!0,n=o}finally{try{e||null==i.return||i.return()}finally{if(a)throw n}}},a.externalWindow=null,a.container=document.createElement("div"),a.props.className&&(a.container.className=a.props.className),a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"copyStyles",value:function(e,t){Array.from(e.styleSheets).forEach(function(a){var n=a;if(n.cssRules){var r=e.createElement("style");Array.from(n.cssRules).forEach(function(t){r.appendChild(e.createTextNode(t.cssText))}),t.head.appendChild(r)}else if(n.href){var i=e.createElement("link");i.rel="stylesheet",i.href=n.href,t.head.appendChild(i)}})}},{key:"componentDidMount",value:function(){window.onunload=this.closeAllExternalWindows,this.externalWindow=window.open("","",this.windowFeatures),this.externalWindow&&(t.windows.push(this.externalWindow),this.externalWindow.document.title=this.props.windowTitle,this.externalWindow.document.body.appendChild(this.container),this.copyStyles(document,this.externalWindow.document),this.externalWindow.onunload=this.props.onUnload)}},{key:"componentWillUnmount",value:function(){var e=this;this.externalWindow&&!this.externalWindow.closed&&this.externalWindow.close(),t.windows=t.windows.filter(function(t){return t!==e.externalWindow})}},{key:"render",value:function(){return o.a.createPortal(this.props.children,this.container)}}]),t}(i.a.PureComponent));H.windows=[];var G,B=function(e){return i.a.createElement("h3",null,W.getFormattedTime(e)," ",i.a.createElement("i",null,e.name))},$=function(e){return void 0===e.status?null:i.a.createElement("span",null,i.a.createElement("b",null,e.status.toLocaleUpperCase(),e.status===R.RUNNABLE&&i.a.createElement(i.a.Fragment,null," (",e.cpuUsage.toFixed(1),"% CPU usage)")),", running for: ",e.runningFor)},K=function(e){return e.locksHeld.length>0&&i.a.createElement("span",null,i.a.createElement("b",null,"Locks held:")," [",e.locksHeld.map(function(e){return e.id}).join(", "),"]")},z=function(e){return e.lockWaitingFor&&i.a.createElement("span",null,i.a.createElement("b",null,"Waiting for notification on lock:")," [",e.lockWaitingFor.id,"]",e.lockWaitingFor.owner?i.a.createElement(i.a.Fragment,null," owned by ",i.a.createElement("i",null,e.lockWaitingFor.owner.name)):i.a.createElement(i.a.Fragment,null," without an owner"))},V=function(e){return i.a.createElement("textarea",{wrap:"off",readOnly:!0,className:"mono stacktrace-window",value:e.stackTrace.join("\n")})},J=function(e){var t=e.thread,a=e.onUnload;return c.b.event({action:"Opened thread details",category:"Navigation"}),i.a.createElement(H,{windowTitle:t.name,className:"thread-details",onUnload:a},B(t),$(t),z(t),K(t),V(t))},Q=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={showDetails:!1},a.handleClick=function(){a.setState(function(e){return{showDetails:!e.showDetails}})},a.handleUnload=function(){a.setState({showDetails:!1})},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.thread;if(!e)return i.a.createElement(i.a.Fragment,null,"     -- ");var t="".concat(e.cpuUsage.toFixed(1),"%"),a=" ".repeat(8-t.length),n=e.cpuUsage>78?"high ":e.cpuUsage>42?"mid ":e.cpuUsage>13?"low ":e.cpuUsage>0?"vlow ":"";return n+="cpu-usage",i.a.createElement(i.a.Fragment,null,a,i.a.createElement("span",{className:n,onClick:this.handleClick},t),this.state.showDetails&&i.a.createElement(J,{thread:e,onUnload:this.handleUnload}))}}]),t}(i.a.PureComponent),q=function(e,t){var a="",n=!0,r=!1,i=void 0;try{for(var l,o=t[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var c=l.value;c&&(a=c.name)}}catch(s){r=!0,i=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return"".concat(e.toFixed(2),'% - "').concat(a,'"')},Y=function(e){for(var t=e.dumpsNumber,a=e.consumer,n=[],r=0;r<t;r++)n.push(a.threadOccurences.get(r));return i.a.createElement("li",null,i.a.createElement("h6",null,q(a.calculatedValue,a.threadOccurences.values())),i.a.createElement("span",{className:"mono"},n.map(function(e,t){return i.a.createElement(Q,{thread:e,key:t})})))},X=function(e){var t=e.limit,a=e.dumpsNumber,n=e.consumers;return i.a.createElement("ul",{id:"consumers-list"},n.slice(0,t).map(function(e,t){return i.a.createElement(Y,{key:t,dumpsNumber:a,consumer:e})}))},Z=(a(202),function(e){var t=e.mode,a=e.limit,n=e.onModeChange,r=e.onLimitChange;return i.a.createElement("div",{id:"settings"},i.a.createElement("div",{className:"filters"},i.a.createElement("b",null,"CPU usage calculation:"),i.a.createElement("label",{className:t===G.Mean?"checked":""},i.a.createElement("input",{type:"checkbox",checked:t===G.Mean,onChange:n(G.Mean)}),"Mean"),i.a.createElement("label",{className:t===G.Median?"checked":""},i.a.createElement("input",{type:"checkbox",checked:t===G.Median,onChange:n(G.Median)}),"Median"),i.a.createElement("label",{className:t===G.Max?"checked":""},i.a.createElement("input",{type:"checkbox",checked:t===G.Max,onChange:n(G.Max)}),"Max")),i.a.createElement("div",{id:"cpu-consumers-limit"},i.a.createElement("label",null,i.a.createElement("input",{type:"number",name:"limit",min:"0",max:"10000",value:a,onChange:r}),i.a.createElement("b",null,"Threads to show"))))});!function(e){e[e.Mean=0]="Mean",e[e.Median=1]="Median",e[e.Max=2]="Max"}(G||(G={}));var ee=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={limit:100,mode:G.Mean},a.PAGE_NAME="CPU Consumers",a.handleModeChange=function(e){return function(){c.b.event({action:"".concat(a.PAGE_NAME," settings changed"),category:"Navigation",label:"Mode changed to ".concat(e)}),a.setState({mode:e})}},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.calculateCpuUsages(this.state.mode);return i.a.createElement("div",{id:"page"},i.a.createElement(Z,{mode:this.state.mode,limit:this.state.limit,onModeChange:this.handleModeChange,onLimitChange:this.handleIntegerChange}),this.props.threadDumps.some(function(e){return!!e.loadAverages&&e.threads.length>0})?i.a.createElement(X,{limit:this.state.limit,dumpsNumber:this.props.threadDumps.length,consumers:e}):i.a.createElement("h4",{dangerouslySetInnerHTML:{__html:t.NO_CPU_AND_THREADS_PAIR}}))}},{key:"calculateCpuUsages",value:function(e){var t=[],a=M(this.props.threadDumps),n=!0,r=!1,i=void 0;try{for(var l,o=a[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var c=l.value;t.push(this.calculateUsageFor(c,e))}}catch(s){r=!0,i=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t.sort(function(e,t){return t.calculatedValue-e.calculatedValue}),t}},{key:"calculateUsageFor",value:function(e,t){var a=Array.from(e.values()),n=0;switch(t){case G.Mean:n=a.reduce(this.reduceSum,0)/this.props.threadDumps.length;break;case G.Median:n=this.calculateMedian(a);break;case G.Max:n=a.reduce(this.reduceMax,0)}return new L(n,e)}},{key:"reduceSum",value:function(e,t){return e+t.cpuUsage}},{key:"reduceMax",value:function(e,t){return t.cpuUsage>e?t.cpuUsage:e}},{key:"calculateMedian",value:function(e){var t=e.slice();t.sort(function(e,t){return e.cpuUsage-t.cpuUsage});var a=Math.floor((t.length-1)/2),n=Math.ceil((t.length-1)/2);return(t[a].cpuUsage+t[n].cpuUsage)/2}}]),t}(P),te=function e(t){var a=this;if(Object(h.a)(this,e),this.loadAverages=void 0,this.runningProcesses=void 0,this.memoryUsage=void 0,this.threads=[],this.locks=[],this.epoch=void 0,this.getEpoch=function(){return a.epoch},t){var n=parseInt(t.substring(11,13),10),r=parseInt(t.substring(14,16),10),i=parseInt(t.substring(17),10);this.epoch=36e5*n+6e4*r+1e3*i}else this.epoch=null};te.getFormattedTime=function(e){return e.epoch?new Date(e.epoch).toLocaleTimeString():"unknown time"};var ae=function e(t,a){Object(h.a)(this,e),this.time=void 0,this.javaClass=void 0,this.owner=void 0,this.waiting=void 0,this.time=te.getFormattedTime(t),this.javaClass=a.className,this.owner=a.owner,this.waiting=a.waiting},ne=function e(t){Object(h.a)(this,e),this.id=void 0,this.waitingSum=0,this.monitors=[],this.id=t},re=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={showOwner:!1},a.handleClick=function(e){e.stopPropagation(),a.setState(function(e){return{showOwner:!e.showOwner}})},a.handleUnload=function(){a.setState({showOwner:!1})},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.monitor;return e.owner?i.a.createElement(i.a.Fragment,null,i.a.createElement("b",null,"Held by:"),i.a.createElement("br",null),i.a.createElement("a",{className:"expandable-details",onClick:this.handleClick},e.owner.name),i.a.createElement("br",null),this.state.showOwner&&i.a.createElement(J,{thread:e.owner,onUnload:this.handleUnload})):null}}]),t}(i.a.PureComponent),ie=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={showDetails:!1},a.handleClick=function(){a.setState(function(e){return{showDetails:!e.showDetails}})},a.handleUnload=function(){a.setState({showDetails:!1})},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.thread;return i.a.createElement(i.a.Fragment,null,i.a.createElement("a",{onClick:this.handleClick},e.name),i.a.createElement("br",null),this.state.showDetails&&i.a.createElement(J,{thread:e,onUnload:this.handleUnload}))}}]),t}(i.a.PureComponent),le=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={expanded:!1},a.toggleExpand=function(){a.setState(function(e){return{expanded:!e.expanded}})},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){if(0===this.props.waiting.length)return null;var e=this.props.waiting.length-t.THREADS_TO_SHOW_WHEN_COLLAPSED,a=this.state.expanded?this.props.waiting:this.props.waiting.slice(0,t.THREADS_TO_SHOW_WHEN_COLLAPSED);return i.a.createElement(i.a.Fragment,null,i.a.createElement("b",null,this.props.waiting.length," thread(s) waiting for notification on lock:"),i.a.createElement("br",null),a.map(function(e,t){return i.a.createElement(ie,{thread:e,key:t})}),e>0&&i.a.createElement("a",{onClick:this.toggleExpand},this.state.expanded?"Collapse threads list (hide ".concat(e," thread(s))"):"Expand threads list (".concat(e," more thread(s) to show)")))}}]),t}(i.a.PureComponent);le.THREADS_TO_SHOW_WHEN_COLLAPSED=20;var oe=function(e){var t=e.monitor,a=t.javaClass?t.javaClass.substring(t.javaClass.lastIndexOf(".")+1):"unknown class";return i.a.createElement("div",{className:"monitors-container"},i.a.createElement("div",{className:"left"},i.a.createElement("b",null,t.time),i.a.createElement("br",null),a),i.a.createElement("div",null,i.a.createElement(re,{monitor:t}),i.a.createElement(le,{waiting:t.waiting})))},ce=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={collapse:!1},a.toggleCollapse=function(){a.setState(function(e){return{collapse:!e.collapse}})},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.monitor;return i.a.createElement(i.a.Fragment,null,i.a.createElement("h6",{className:"clickable",onClick:this.toggleCollapse},i.a.createElement("span",{className:this.state.collapse?"chevron rotate":"chevron"}),e.waitingSum," thread(s) waiting for <",e.id,">"),!this.state.collapse&&e.monitors.map(function(e,t){return i.a.createElement(oe,{key:t,monitor:e})}))}}]),t}(i.a.PureComponent),se=(a(203),a(204),function(e){var t=e.name,a=e.displayName,n=e.checked,r=e.onChange;return i.a.createElement("label",{className:n?"checked":""},i.a.createElement("input",{type:"checkbox",name:t,checked:n,onChange:r}),a)}),ue=function(e){var t=e.withOwner,a=e.withoutIdle,n=e.withoutOwner,r=e.onFilterChange;return i.a.createElement("div",{id:"settings"},i.a.createElement("div",{className:"filters"},i.a.createElement("b",null,"Filters:"),i.a.createElement(se,{name:"withoutIdle",displayName:"Without Idle",checked:a,onChange:r}),i.a.createElement(se,{name:"withOwner",displayName:"With Owner",checked:t,onChange:r}),i.a.createElement(se,{name:"withoutOwner",displayName:"Without Owner",checked:n,onChange:r})))},he=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={withOwner:!1,withoutIdle:!0,withoutOwner:!1},a.PAGE_NAME="Monitors",a.getMonitorsOverTime=function(e){var t=new Map;return e.forEach(function(e){e.locks.forEach(function(a){var n=new ae(e,a),r=t.get(a.id);r||(r=new ne(a.id),t.set(a.id,r)),r.monitors.push(n),r.waitingSum+=n.waiting.length})}),Array.from(t.values()).sort(function(e,t){return t.waitingSum-e.waitingSum})},a.filterMonitors=function(e){var t=e.filter(function(e){return e.waitingSum>0});return a.state.withoutIdle&&(t=t.filter(function(e){return!a.isQueueThread(e)})),a.state.withOwner&&(t=t.filter(function(e){return a.hasAnyOwner(e)})),a.state.withoutOwner&&(t=t.filter(function(e){return!a.hasAnyOwner(e)})),t},a.hasAnyOwner=function(e){return e.monitors.some(function(e){return null!==e.owner})},a.isQueueThread=function(e){var t=!0,a=!1,n=void 0;try{for(var r,i=e.monitors[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var l=r.value;if(null!==l.owner)return!1;var o=!0,c=!1,s=void 0;try{for(var u,h=l.waiting[Symbol.iterator]();!(o=(u=h.next()).done);o=!0){if(u.value.stackTrace.length>12)return!1}}catch(m){c=!0,s=m}finally{try{o||null==h.return||h.return()}finally{if(c)throw s}}}}catch(m){a=!0,n=m}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}return!0},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.getMonitorsOverTime(this.props.threadDumps),a=this.filterMonitors(e);return i.a.createElement("div",{id:"page"},i.a.createElement(ue,{withOwner:this.state.withOwner,withoutIdle:this.state.withoutIdle,withoutOwner:this.state.withoutOwner,onFilterChange:this.handleFilterChange}),this.props.threadDumps.some(function(e){return e.threads.length>0})?0===a.length?i.a.createElement("h4",null,t.N0_MONITORS_MATCHING):a.map(function(e){return i.a.createElement(ce,{key:e.id,monitor:e})}):i.a.createElement("h4",{dangerouslySetInnerHTML:{__html:t.NO_THREAD_DUMPS}}))}}]),t}(P),me=(a(205),function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).onClear=function(){c.b.event({action:"Cleared thread dumps",category:"Navigation"}),j(),a.props.history.push("/")},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.match.params.key;return i.a.createElement("nav",{className:this.props.open?"open":""},i.a.createElement("h1",{id:this.props.open?"brand-visible":"brand-hidden"},"Watson"),i.a.createElement("ul",null,i.a.createElement(s.b,{to:"/".concat(e,"/summary/")},i.a.createElement("li",null,"Summary"))),i.a.createElement("ul",null,i.a.createElement(s.b,{to:"/".concat(e,"/cpu-consumers/")},i.a.createElement("li",null,"CPU Consumers")),i.a.createElement(s.b,{to:"/".concat(e,"/similar-stacks/")},i.a.createElement("li",null,"Similar Stack Traces")),i.a.createElement(s.b,{to:"/".concat(e,"/stuck-threads/")},i.a.createElement("li",null,"Stuck Threads Suspects")),i.a.createElement(s.b,{to:"/".concat(e,"/threads-overview/")},i.a.createElement("li",null,"Threads Overview")),i.a.createElement(s.b,{to:"/".concat(e,"/monitors/")},i.a.createElement("li",null,"Monitors"))),i.a.createElement("div",{id:"nav-content-bottom"},i.a.createElement("ul",null,i.a.createElement("li",{onClick:this.onClear},"Load another thread dump")),i.a.createElement("ul",null,i.a.createElement(c.a,{eventLabel:"Issue tracker",to:"https://github.com/drauf/watson/issues",target:"_blank"},i.a.createElement("li",null,"Issue tracker")),i.a.createElement(c.a,{eventLabel:"Source code",to:"https://github.com/drauf/watson",target:"_blank"},i.a.createElement("li",null,"Source code")))))}}]),t}(i.a.PureComponent)),de=Object(u.e)(me),pe=(a(212),function(e){var t=e.open,a=e.onClick;return i.a.createElement("div",{className:t?"nav-toggle open":"nav-toggle",onClick:a},i.a.createElement("div",{id:"nav-arrow"}))}),fe=function(){return i.a.createElement("h4",{id:"centered"},"Oops, you've found a dead link!")};function ge(e){return e.stackTrace.length<17||e.name.includes("rufus-scheduler")&&"org.jruby.ext.thread.Queue$INVOKER$i$pop.call(Queue$INVOKER$i$pop.gen)"===e.stackTrace[7]||"org.jruby.RubyKernel$INVOKER$s$0$1$sleep.call(RubyKernel$INVOKER$s$0$1$sleep.gen)"===e.stackTrace[3]||e.name.includes("rubinius-actor")&&"org.jruby.ext.rubinius.RubiniusChannel$INVOKER$i$0$0$receive.call(RubiniusChannel$INVOKER$i$0$0$receive.gen)"===e.stackTrace[5]}var ve=function(e){var t=e.stackTrace,a=e.linesToConsider,n=a>0?t.slice(0,a):t;return i.a.createElement("ol",{className:"stacktrace"},n.map(function(e,t){return i.a.createElement("li",{key:t},e)}))},Ee=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={showDetails:!1,showLockOwner:!1},a.toggleDetails=function(){a.setState(function(e){return{showDetails:!e.showDetails}})},a.toggleLockOwner=function(){a.setState(function(e){return{showLockOwner:!e.showLockOwner}})},a.handleUnload=function(){a.setState({showDetails:!1,showLockOwner:!1})},a.getLocksHeldString=function(e){return 0===e.locksHeld.length?null:e.locksHeld.map(function(e){return e.id}).reduce(a.locksReducer)},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.thread,t=e.lockWaitingFor?e.lockWaitingFor.owner:null,a=this.getLocksHeldString(e);return i.a.createElement("li",null,i.a.createElement("a",{onClick:this.toggleDetails},'"',e.name,'"')," ".concat(W.getFormattedTime(e)),this.waitingForRender(e,t),e.locksHeld.length>0&&", holding [".concat(a,"]"),this.state.showDetails&&i.a.createElement(J,{thread:e,onUnload:this.handleUnload}),this.state.showLockOwner&&t&&i.a.createElement(J,{thread:t,onUnload:this.handleUnload}))}},{key:"waitingForRender",value:function(e,t){var a=e.lockWaitingFor?e.lockWaitingFor.id:null;return a?t?(console.error(e),i.a.createElement(i.a.Fragment,null,", awaiting notification on ",i.a.createElement("a",{onClick:this.toggleLockOwner},"[",a,"]"))):", awaiting notification on [".concat(a,"] without an owner"):null}},{key:"locksReducer",value:function(e,t,a){return 0===a?t:"".concat(e,", ").concat(t)}}]),t}(i.a.PureComponent),ye=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={expanded:!1},a.toggleExpand=function(){a.setState(function(e){return{expanded:!e.expanded}})},a.getStackTrace=function(e){var t=!0,a=!1,n=void 0;try{for(var r,i=e[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var l=r.value;if(l)return l.stackTrace}}catch(o){a=!0,n=o}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}return[]},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.getStackTrace(this.props.threadGroup),a=this.props.threadGroup.sort(function(e,t){return e.name.localeCompare(t.name)}),n=a.length-t.THREADS_TO_SHOW_WHEN_COLLAPSED,r=this.state.expanded?a:a.slice(0,t.THREADS_TO_SHOW_WHEN_COLLAPSED);return i.a.createElement(i.a.Fragment,null,i.a.createElement("ul",null,r.map(function(e,t){return i.a.createElement(Ee,{key:t,thread:e})}),n>0&&i.a.createElement("li",null,i.a.createElement("a",{onClick:this.toggleExpand},this.state.expanded?"Collapse threads list (hide ".concat(n," thread(s))"):"Expand threads list (".concat(n," more thread(s) to show)")))),i.a.createElement(ve,{stackTrace:e,linesToConsider:this.props.linesToConsider}))}}]),t}(i.a.PureComponent);ye.THREADS_TO_SHOW_WHEN_COLLAPSED=20;var we=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={showDetails:!0},a.toggleGroup=function(){a.setState(function(e){return{showDetails:!e.showDetails}})},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement("h6",{className:"clickable",onClick:this.toggleGroup},i.a.createElement("span",{className:this.state.showDetails?"chevron":"chevron rotate"}),this.props.threadGroup.length," thread(s) with this stack:"),this.state.showDetails&&i.a.createElement(ye,{threadGroup:this.props.threadGroup,linesToConsider:this.props.linesToConsider}))}}]),t}(i.a.PureComponent),be=(a(213),function(e){var t=e.linesToConsider,a=e.minimalGroupSize,n=e.withoutIdle,r=e.onFilterChange,l=e.onIntegerChange;return i.a.createElement("div",{id:"settings"},i.a.createElement("div",{className:"filters"},i.a.createElement("b",null,"Filters:"),i.a.createElement(se,{name:"withoutIdle",displayName:"Without Idle",checked:n,onChange:r})),i.a.createElement("label",null,i.a.createElement("input",{type:"number",name:"linesToConsider",value:t,onChange:l}),i.a.createElement("b",null,"Stack trace lines to compare")),i.a.createElement("label",null,i.a.createElement("input",{type:"number",name:"minimalGroupSize",value:a,onChange:l}),i.a.createElement("b",null,"Minimal group size to show")))}),ke=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={linesToConsider:40,minimalGroupSize:2,withoutIdle:!0},a.PAGE_NAME="Similar Stacks",a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,a=this.groupByStackTrace(this.props.threadDumps,this.state.linesToConsider).filter(function(t){return t.length>=e.state.minimalGroupSize});return i.a.createElement("div",{id:"page"},i.a.createElement(be,{linesToConsider:this.state.linesToConsider,minimalGroupSize:this.state.minimalGroupSize,withoutIdle:this.state.withoutIdle,onFilterChange:this.handleFilterChange,onIntegerChange:this.handleIntegerChange}),this.props.threadDumps.some(function(e){return e.threads.length>0})?0===a.length?i.a.createElement("h4",null,t.N0_THREADS_MATCHING):a.map(function(t,a){return i.a.createElement(we,{key:a,threadGroup:t,linesToConsider:e.state.linesToConsider})}):i.a.createElement("h4",{dangerouslySetInnerHTML:{__html:t.NO_THREAD_DUMPS}}))}},{key:"groupByStackTrace",value:function(e,t){var a=this,n=new Map;return e.forEach(function(e){e.threads.forEach(function(e){var r=a.getStackTrace(e,t);if(r){var i=n.get(r);i||(i=[]),i.push(e),n.set(r,i)}})}),Array.from(n.values()).sort(function(e,t){return t.length-e.length})}},{key:"getStackTrace",value:function(e,t){return this.state.withoutIdle&&ge(e)?null:t<1?e.stackTrace.toString():e.stackTrace.slice(0,t).toString()}}]),t}(P),Oe=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={showDetails:!1},a.handleClick=function(){a.setState(function(e){return{showDetails:!e.showDetails}})},a.handleUnload=function(){a.setState({showDetails:!1})},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.thread,t=e.stackTrace.slice(0,Math.max(this.props.maxDifferingLines,10));return i.a.createElement(i.a.Fragment,null,i.a.createElement("b",null,W.getFormattedTime(e)),i.a.createElement("ul",{className:"stacktrace"},t.map(function(e,t){return i.a.createElement("li",{key:t},e)}),i.a.createElement("li",null,i.a.createElement("a",{onClick:this.handleClick},"See thread details"))),this.state.showDetails&&i.a.createElement(J,{thread:e,onUnload:this.handleUnload}))}}]),t}(i.a.PureComponent),Te=function(e){var t=e.maxDifferingLines,a=e.threadGroup;return i.a.createElement(i.a.Fragment,null,a.map(function(e,a){return i.a.createElement(Oe,{key:a,thread:e,maxDifferingLines:t})}))},Ce=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={showDetails:!0},a.toggleGroup=function(){a.setState(function(e){return{showDetails:!e.showDetails}})},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){if(0===this.props.threadGroup.length)return null;var e=this.props.threadGroup[0];return i.a.createElement(i.a.Fragment,null,i.a.createElement("h6",{className:"clickable",onClick:this.toggleGroup},i.a.createElement("span",{className:this.state.showDetails?"chevron":"chevron rotate"}),this.props.threadGroup.length,' similar stack(s) for "',e.name,'"'),this.state.showDetails&&i.a.createElement(Te,{threadGroup:this.props.threadGroup,maxDifferingLines:this.props.maxDifferingLines}))}}]),t}(i.a.PureComponent),De=function(e){var t=e.maxDifferingLines,a=e.minClusterSize,n=e.withoutIdle,r=e.onFilterChange,l=e.onIntegerChange;return i.a.createElement("div",{id:"settings"},i.a.createElement("div",{className:"filters"},i.a.createElement("b",null,"Filters:"),i.a.createElement(se,{name:"withoutIdle",displayName:"Without Idle",checked:n,onChange:r})),i.a.createElement("label",null,i.a.createElement("input",{type:"number",min:"2",name:"minClusterSize",value:a,onChange:l}),i.a.createElement("b",null,"Minimal similar stacks to consider a thread stuck")),i.a.createElement("label",null,i.a.createElement("input",{type:"number",name:"maxDifferingLines",value:t,onChange:l}),i.a.createElement("b",null,"Maximum differing lines between dumps")))},Se=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e))).PAGE_NAME="Stuck Threads",a.filterThreads=function(e){return e.map(function(e){return a.filterThread(e)}).filter(function(e){return e.length>0})},a.filterThread=function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var l,o=e[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var c=l.value;a.state.withoutIdle&&ge(c[1])||t.push(c[1])}}catch(s){r=!0,i=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t},a.buildClusters=function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var l,o=e[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var c=l.value;a.getClustersFromThread(c).filter(function(e){return e.length>=a.state.minClusterSize}).forEach(function(e){return t.push(e)})}}catch(s){r=!0,i=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t.sort(function(e,t){return t.length-e.length})},a.getClustersFromThread=function(e){for(var t=[],n=[e[0]],r=1;r<e.length;r++){var i=e[r-1],l=e[r];a.areThreadsSimilarEnough(i,l)?n.push(l):(t.push(n),n=[l])}return t.push(n),t},a.areThreadsSimilarEnough=function(e,t){var n=e.stackTrace,r=t.stackTrace;if(Math.abs(n.length-r.length)>a.state.maxDifferingLines)return!1;for(var i=Math.max(n.length,r.length);i>=0;i--)if(n[i]!==r[i])return i<=a.state.maxDifferingLines;return!0},a.state={maxDifferingLines:5,minClusterSize:a.props.threadDumps.length,withoutIdle:!0},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,a=M(this.props.threadDumps),n=this.filterThreads(a),r=this.buildClusters(n);return i.a.createElement("div",{id:"page"},i.a.createElement(De,{maxDifferingLines:this.state.maxDifferingLines,minClusterSize:this.state.minClusterSize,withoutIdle:this.state.withoutIdle,onFilterChange:this.handleFilterChange,onIntegerChange:this.handleIntegerChange}),this.props.threadDumps.some(function(e){return e.threads.length>0})?0===r.length?i.a.createElement("h4",null,t.N0_THREADS_MATCHING):r.map(function(t,a){return i.a.createElement(Ce,{key:a,threadGroup:t,maxDifferingLines:e.state.maxDifferingLines})}):i.a.createElement("h4",{dangerouslySetInnerHTML:{__html:t.NO_THREAD_DUMPS}}))}}]),t}(P),je=a(12),Ne=function(e){var t=e.threadDumps,a=[];return t.map(function(e){e.loadAverages&&a.push({fifteenMinutes:e.loadAverages.fifteenMinutes,fiveMinutes:e.loadAverages.fiveMinutes,name:te.getFormattedTime(e),oneMinute:e.loadAverages.oneMinute})}),i.a.createElement("div",{className:"chart"},i.a.createElement("h3",null,"Load averages"),i.a.createElement(je.h,{width:"100%",height:350},i.a.createElement(je.e,{data:a},i.a.createElement(je.j,{dataKey:"name"}),i.a.createElement(je.k,{type:"number"}),i.a.createElement(je.a,{stroke:"#EBECF0",strokeDasharray:"5 5"}),i.a.createElement(je.i,null),i.a.createElement(je.c,null),i.a.createElement(je.d,{name:"One minute",dataKey:"oneMinute",stroke:"#36B37E"}),i.a.createElement(je.d,{name:"Five minutes",dataKey:"fiveMinutes",stroke:"#FFAB00"}),i.a.createElement(je.d,{name:"Fifteen minutes",dataKey:"fifteenMinutes",stroke:"#6554C0"}))))},Fe=function(e){return e>1e6?"".concat(xe(e/1e6)," GB"):"".concat(xe(e/1e3)," MB")},xe=function(e){return e.toFixed(2)},Ae=function(e){return Fe(e)},Me=["#00B8D9","#36B37E"],Ie=function(e){var t=e.threadDumps.map(function(e){return e.memoryUsage}).filter(function(e){return!!e}),a=t.reduce(function(e,t){return e+t.memoryFree},0)/t.length,n=[{name:"Used memory",value:t.reduce(function(e,t){return e+t.memoryUsed},0)/t.length},{name:"Free memory",value:a}];return i.a.createElement("div",null,i.a.createElement("h3",null,"Memory usage"),i.a.createElement(je.h,{width:"100%",height:250},i.a.createElement(je.g,null,i.a.createElement(je.f,{data:n,dataKey:"value",nameKey:"name"},n.map(function(e,t){return i.a.createElement(je.b,{key:t,fill:Me[t]})})),i.a.createElement(je.i,{formatter:Ae}),i.a.createElement(je.c,null))))},Ue=function(e){var t=e.threadDumps,a=[];return t.map(function(e){e.loadAverages&&a.push({name:te.getFormattedTime(e),runningProcesses:e.runningProcesses})}),i.a.createElement("div",{className:"chart"},i.a.createElement("h3",null,"Running processes"),i.a.createElement(je.h,{width:"100%",height:250},i.a.createElement(je.e,{data:a},i.a.createElement(je.j,{dataKey:"name"}),i.a.createElement(je.k,{type:"number"}),i.a.createElement(je.a,{stroke:"#EBECF0",strokeDasharray:"5 5"}),i.a.createElement(je.i,null),i.a.createElement(je.c,null),i.a.createElement(je.d,{name:"Running processes",dataKey:"runningProcesses",stroke:"#36B37E"}))))},Pe=(a(392),["#6554C0","#FF5630"]),_e=function(e){var t=e.threadDumps.map(function(e){return e.memoryUsage}).filter(function(e){return!!e}),a=[{name:"Free swap",value:t.reduce(function(e,t){return e+t.swapFree},0)/t.length},{name:"Used swap",value:t.reduce(function(e,t){return e+t.swapUsed},0)/t.length}];return i.a.createElement("div",null,i.a.createElement("h3",null,"Swap usage"),i.a.createElement(je.h,{width:"100%",height:250},i.a.createElement(je.g,null,i.a.createElement(je.f,{data:a,dataKey:"value",nameKey:"name"},a.map(function(e,t){return i.a.createElement(je.b,{key:t,fill:Pe[t]})})),i.a.createElement(je.i,{formatter:Ae}),i.a.createElement(je.c,null))))},Le=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).render=function(){return i.a.createElement("div",{id:"wide-page"},a.props.threadDumps.some(function(e){return!!e.loadAverages})?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{id:"memory-usages"},i.a.createElement(Ie,{threadDumps:a.props.threadDumps}),i.a.createElement(_e,{threadDumps:a.props.threadDumps})),i.a.createElement(Ne,{threadDumps:a.props.threadDumps}),i.a.createElement(Ue,{threadDumps:a.props.threadDumps})):i.a.createElement("h4",{dangerouslySetInnerHTML:{__html:t.NO_CPU_INFOS}}))},a}return Object(f.a)(t,e),t}(P),We=function(e,t){return e+Array.from(t.values()).reduce(Re,0)},Re=function(e,t){return e+(t.matchingFilter?1:0)},He=function(e,t){return e+Array.from(t.values()).length},Ge=function(e){var t=e.isFilteredByStack,a=e.threadsNumber,n=e.threadDumps;if(t){var r=n.reduce(We,0),l=n.reduce(He,0),o=(r/l*100).toFixed(1);return i.a.createElement("p",{id:"matching-summary"},r," out of ",l," (",o,"%) visible threads matching the stack trace filters")}if(a!==n.length){var c=n.length,s=(c/a*100).toFixed(1);return i.a.createElement("p",{id:"matching-summary"},c," out of ",a," (",s,"%) threads matching the thread name filters")}return i.a.createElement("p",{id:"matching-summary"})},Be=function(){return i.a.createElement("table",{id:"thread-overview-legend"},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",{className:"runnable"},"runnable"),i.a.createElement("td",{className:"blocked"},"blocked"),i.a.createElement("td",{className:"waiting"},"waiting"),i.a.createElement("td",{className:"timed-waiting"},"timed waiting"),i.a.createElement("td",{className:"unknown"},"unknown"),i.a.createElement("td",null),i.a.createElement("td",{className:"matching"},"matching filter"))))},$e=(a(393),function(e){var t=e.nonJvm,a=e.tomcat,n=e.nonTomcat,r=e.database,l=e.lucene,o=e.nameFilter,c=e.stackFilter,s=e.onFilterChange,u=e.onRegExpChange;return i.a.createElement("div",{id:"threads-overview-settings"},i.a.createElement("div",{className:"filters"},i.a.createElement("b",null,"Filters:"),i.a.createElement(se,{name:"nonJvm",displayName:"Non-JVM",checked:t,onChange:s}),i.a.createElement(se,{name:"tomcat",displayName:"Tomcat",checked:a,onChange:s}),i.a.createElement(se,{name:"nonTomcat",displayName:"Non-Tomcat",checked:n,onChange:s}),i.a.createElement(se,{name:"database",displayName:"Database",checked:r,onChange:s}),i.a.createElement(se,{name:"lucene",displayName:"Lucene",checked:l,onChange:s})),i.a.createElement("div",{id:"regexp-filters"},i.a.createElement("label",null,i.a.createElement("input",{type:"text",name:"nameFilter",value:o,onChange:u}),i.a.createElement("b",null,"Thread name RegExp")),i.a.createElement("label",null,i.a.createElement("input",{type:"text",name:"stackFilter",value:c,onChange:u}),i.a.createElement("b",null,"Stack trace RegExp"))))}),Ke=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={showDetails:!1},a.toggleDetails=function(){a.setState(function(e){return{showDetails:!e.showDetails}})},a.handleUnload=function(){a.setState({showDetails:!1})},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.thread;if(!e)return i.a.createElement("td",{className:"empty"});var t=this.props.isFiltered?this.props.isMatchingFilter?"matching":"":e.status?e.status.toString():R.UNKNOWN.toString();return i.a.createElement(i.a.Fragment,null,i.a.createElement("td",{className:t,onClick:this.toggleDetails},e.stackTrace[0],i.a.createElement("span",null,e.stackTrace[0])),this.state.showDetails&&i.a.createElement(J,{thread:e,onUnload:this.handleUnload}))}}]),t}(i.a.PureComponent),ze=function(e){for(var t=e.total,a=e.threads,n=e.isFiltered,r=[],l=0;l<t;l++)r[l]=a.get(l);var o=r.find(function(e){return void 0!==e}),c=o?o.name:"";return i.a.createElement("tr",null,i.a.createElement("td",{className:"name"},c,i.a.createElement("span",null,c)),r.map(function(e,t){return i.a.createElement(Ke,{key:t,thread:e,isFiltered:n,isMatchingFilter:!!e&&e.matchingFilter})}))},Ve=function(e){var t=e.dates,a=e.isFilteredByStack,n=e.threadDumps;return i.a.createElement("div",{id:"threads-overview-table-wrapper"},i.a.createElement("table",null,i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null),t.map(function(e,t){return i.a.createElement("th",{key:t},e,i.a.createElement("span",null,e))}))),i.a.createElement("tbody",null,n.map(function(e,n){return i.a.createElement(ze,{key:n,isFiltered:a,total:t.length,threads:e})}))))},Je=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={nonJvm:!0,tomcat:!1,nonTomcat:!1,database:!1,lucene:!1,nameFilter:"",stackFilter:""},a.PAGE_NAME="Threads Overview",a.jvmRegex=/^Attach Listener|^C[12] CompilerThread|^G1 Concurrent |^G1 Main|^Gang worker#|^GC Daemon|^Service Thread|^Signal Dispatcher|^String Deduplication Thread|^Surrogate Locker Thread|^VM Periodic|^VM Thread/,a.tomcatRegex=/^http(s\-jsse)?\-[a-z]io\-[0-9]+\-exec\-[0-9]+/,a.databaseRegex=/^oracle\.jdbc\.driver\.|^org\.postgresql\.|^com\.microsoft\.sqlserver\.|^com\.mysql\.jdbc\./,a.luceneRegex=/^org\.apache\.lucene\./,a.isFilteredByStack=function(){return a.state.stackFilter.length>0||a.state.lucene||a.state.database},a.filterThreads=function(e){var t=e;return t=a.filterByName(t,a.state.nameFilter),a.markMatchingStackFilter(t,a.state.stackFilter),t},a.filterByName=function(e,t){var n;if(t)try{n=new RegExp(t,"i")}catch(r){}return e.filter(function(e){return!a.state.nonJvm||!a.matchesName(e,a.jvmRegex)}).filter(function(e){return!a.state.tomcat||a.matchesName(e,a.tomcatRegex)}).filter(function(e){return!a.state.nonTomcat||!a.matchesName(e,a.tomcatRegex)}).filter(function(e){return!n||a.matchesName(e,n)})},a.markMatchingStackFilter=function(e,t){a.clearAllMatches(e);var n=a.getStackTraceFilters(t);0!==n.length&&e.forEach(function(e){e.forEach(function(e){return a.markIfMatchesAllFilters(e,n)})})},a.clearAllMatches=function(e){e.forEach(function(e){e.forEach(function(e){e.matchingFilter=!1})})},a.getStackTraceFilters=function(e){var t=[];if(e)try{var n=new RegExp(e,"i");t.push(n)}catch(r){}return a.state.lucene&&t.push(a.luceneRegex),a.state.database&&t.push(a.databaseRegex),t},a.markIfMatchesAllFilters=function(e,t){var n=!0,r=!1,i=void 0;try{for(var l,o=t[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var c=l.value;if(!a.matchesStackTraceFilter(e,c))return}}catch(s){r=!0,i=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}e.matchingFilter=!0},a.matchesStackTraceFilter=function(e,t){var a=!0,n=!1,r=void 0;try{for(var i,l=e.stackTrace[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var o=i.value;if(t.test(o))return!0}}catch(c){n=!0,r=c}finally{try{a||null==l.return||l.return()}finally{if(n)throw r}}return!1},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=M(this.props.threadDumps),a=this.filterThreads(e),n=this.props.threadDumps.map(function(e){return te.getFormattedTime(e)}),r=this.isFilteredByStack();return i.a.createElement("div",{id:"wide-page"},i.a.createElement($e,{nonJvm:this.state.nonJvm,tomcat:this.state.tomcat,nonTomcat:this.state.nonTomcat,database:this.state.database,lucene:this.state.lucene,nameFilter:this.state.nameFilter,stackFilter:this.state.stackFilter,onFilterChange:this.handleFilterChange,onRegExpChange:this.handleRegExpChange}),i.a.createElement(Ge,{isFilteredByStack:r,threadsNumber:e.length,threadDumps:a}),i.a.createElement(Be,null),this.props.threadDumps.some(function(e){return e.threads.length>0})?i.a.createElement(Ve,{dates:n,isFilteredByStack:r,threadDumps:a}):i.a.createElement("h4",{dangerouslySetInnerHTML:{__html:t.NO_THREAD_DUMPS}}))}},{key:"matchesName",value:function(e,t){var a=!0,n=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var o=i.value;if(t.test(o[1].name))return!0}}catch(c){n=!0,r=c}finally{try{a||null==l.return||l.return()}finally{if(n)throw r}}return!1}}]),t}(P),Qe=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={navigationOpen:!0},a.toggleNavigation=function(){a.setState(function(e){var t=!e.navigationOpen;return c.b.event({action:t?"Navigation toggled open":"Navigation toggled close",category:"Navigation"}),{navigationOpen:t}})},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{id:"container"},i.a.createElement(de,{open:this.state.navigationOpen}),i.a.createElement(pe,{open:this.state.navigationOpen,onClick:this.toggleNavigation}),i.a.createElement("div",{id:"content"},i.a.createElement(u.c,null,i.a.createElement(u.a,{exact:!0,path:"/:key/summary/",component:x(Le)}),i.a.createElement(u.a,{exact:!0,path:"/:key/cpu-consumers/",component:x(ee)}),i.a.createElement(u.a,{exact:!0,path:"/:key/similar-stacks/",component:x(ke)}),i.a.createElement(u.a,{exact:!0,path:"/:key/stuck-threads/",component:x(Se)}),i.a.createElement(u.a,{exact:!0,path:"/:key/threads-overview/",component:x(Je)}),i.a.createElement(u.a,{exact:!0,path:"/:key/monitors/",component:x(he)}),i.a.createElement(u.a,{component:x(fe)}))))}}]),t}(i.a.PureComponent),qe=a(167),Ye=function e(t){var a=this;Object(h.a)(this,e),this.runningProcesses=void 0,this.loadAverages=void 0,this.memoryUsage=void 0,this.threadCpuUsages=void 0,this.epoch=void 0,this.getEpoch=function(){return a.epoch};var n=parseInt(t.substring(0,2),10),r=parseInt(t.substring(3,5),10),i=parseInt(t.substring(6),10);this.epoch=36e5*n+6e4*r+1e3*i},Xe=function e(){Object(h.a)(this,e),this.oneMinute=void 0,this.fiveMinutes=void 0,this.fifteenMinutes=void 0},Ze=function e(){Object(h.a)(this,e),this.memoryTotal=void 0,this.memoryUsed=void 0,this.memoryFree=void 0,this.swapTotal=void 0,this.swapUsed=void 0,this.swapFree=void 0},et=function e(){Object(h.a)(this,e),this.id=void 0,this.cpuUsage=void 0,this.runningFor=void 0};function tt(e,t){var a=e.exec(t||"");return a?a[1]:""}function at(e,t){var a=e.exec(t||"");return null!=a?a.slice(1):[]}function nt(e,t){for(var a=[],n=e.exec(t||"");null!=n;)a.push(n[1]),n=e.exec(t||"");return a}var rt=/^top - ([0-9]{2}:[0-9]{2}:[0-9]{2})/,it=/ load average: ([0-9\.]+), ([0-9\.]+), ([0-9\.]+)/,lt=/([0-9\.]+) running/,ot=/([0-9\.]+)k?[ +]total/,ct=/([0-9\.]+)k? used/,st=/([0-9\.]+)k? free/,ut=/([^\s]+) +/g,ht=function(){function e(){Object(h.a)(this,e)}return Object(m.a)(e,null,[{key:"parseCpuUsage",value:function(t,a){var n=new Ye(tt(rt,t[0]));n.loadAverages=e.parseLoadAverages(t.shift()),n.runningProcesses=e.parseRunningProcesses(t.shift()),t.shift(),n.memoryUsage=e.parseMemoryUsage(t.shift(),t.shift()),n.threadCpuUsages=e.parseThreadCpuUsages(t),a(n)}},{key:"parseLoadAverages",value:function(e){var t=at(it,e);if(3!==t.length)return console.error("Unable to parse load averages from line: ".concat(e)),null;var a=new Xe;return a.oneMinute=parseFloat(t[0]),a.fiveMinutes=parseFloat(t[1]),a.fifteenMinutes=parseFloat(t[2]),a}},{key:"parseRunningProcesses",value:function(e){return parseInt(tt(lt,e),10)}},{key:"parseMemoryUsage",value:function(e,t){var a=new Ze;return a.memoryTotal=parseInt(tt(ot,e),10),a.memoryUsed=parseInt(tt(ct,e),10),a.memoryFree=parseInt(tt(st,e),10),a.swapTotal=parseInt(tt(ot,t),10),a.swapUsed=parseInt(tt(ct,t),10),a.swapFree=parseInt(tt(st,t),10),a}},{key:"parseThreadCpuUsages",value:function(e){for(var t=[],a=2;a<e.length;a++){var n=e[a];if(n){var r=nt(ut,n);if(r.length<11)console.error("Unable to parse thread cpu usage info from line: ".concat(n));else{var i=new et;i.id=parseInt(r[0],10),i.cpuUsage=parseFloat(r[8]),i.runningFor=r[10],t.push(i)}}}return t}}]),e}(),mt=function e(){Object(h.a)(this,e),this.id=void 0,this.className=void 0,this.owner=null,this.waiting=[]},dt=/^([0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2})\r?$/,pt=/^\"(.*)\" /,ft=/ nid=([0-9a-fx,]+)/,gt=/ tid=([0-9a-fx,]+)/,vt=/^\s+at (.*)/,Et=/^\s*java.lang.Thread.State: (.*)/,yt=/^\s+- (.*?) +<([x0-9a-f]+)> \(a (.*)\)/,wt=/^\s+Locked ownable synchronizers:/,bt=/^\s+- None/,kt=/^\s+- <([x0-9a-f]+)> \(a (.*)\)/,Ot=/^\s?JNI global references: (\d+)/,Tt=function(){function e(){Object(h.a)(this,e)}return Object(m.a)(e,null,[{key:"parseThreadDump",value:function(t,a){var n=new te(tt(dt,t.shift()));t.forEach(function(t){return e.parseLine(t,n)}),e.identifyAnonymousSynchronizers(n.threads),a(n)}},{key:"parseLine",value:function(t,a){t.startsWith('"')?e.parseThreadHeader(t,a):t&&e.parseStackLine(t,a)}},{key:"parseThreadHeader",value:function(t,a){var n=tt(pt,t).trim(),r=parseInt(tt(ft,t),16),i=parseInt(tt(gt,t),16),l=0!==r?r:i;e.currentThread=new W(l,n,a.getEpoch()),a.threads.push(e.currentThread)}},{key:"parseStackLine",value:function(t,a){if(e.currentThread){var n=tt(vt,t);if(n)e.currentThread.stackTrace.push(n);else{var r=tt(Et,t);if(r)e.currentThread.status=e.stringToThreadStatus(r);else{var i=at(yt,t);if(i&&3===i.length){var l=i[0],o=i[1],c=i[2];switch(l){case"waiting on":case"parking to wait for":case"waiting to lock":var s=e.getOrCreateLock(a.locks,o,c);return s.waiting.push(e.currentThread),void(e.currentThread.lockWaitingFor=s);case"locked":if(e.currentThread.lockWaitingFor&&e.currentThread.lockWaitingFor.id===o)return;return(s=e.getOrCreateLock(a.locks,o,c)).owner=e.currentThread,e.currentThread.locksHeld.push(s),void e.currentThread.classicalLocksHeld.push(s);case"eliminated":return;default:return void console.warn("Unknown synchronziation status: ".concat(t))}}var u=at(kt,t);if(u&&2===u.length){var h=u[0],m=u[1],d=e.getOrCreateLock(a.locks,h,m);return d.owner=e.currentThread,void e.currentThread.locksHeld.push(d)}tt(wt,t)||tt(bt,t)||tt(Ot,t)||console.warn("Unable to parse line: ".concat(t))}}}}},{key:"identifyAnonymousSynchronizers",value:function(e){var t=[R.BLOCKED,R.TIMED_WAITING,R.WAITING];e.filter(function(e){return!e.lockWaitingFor}).filter(function(e){return void 0!==e.status&&t.includes(e.status)}).forEach(function(e){var t=e.classicalLocksHeld[0];t&&(t.owner=null,t.waiting.push(e),e.lockWaitingFor=t,e.locksHeld.splice(e.locksHeld.indexOf(t),1),e.classicalLocksHeld.splice(e.classicalLocksHeld.indexOf(t),1))})}},{key:"stringToThreadStatus",value:function(e){var t=R[e];return t||(e.startsWith("BLOCKED")?R.BLOCKED:e.startsWith("WAITING")?R.WAITING:e.startsWith("TIMED_WAITING")?R.TIMED_WAITING:R.UNKNOWN)}},{key:"getOrCreateLock",value:function(e,t,a){var n=!0,r=!1,i=void 0;try{for(var l,o=e[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var c=l.value;if(c.id===t)return c}}catch(u){r=!0,i=u}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}var s=new mt;return s.id=t,s.className=a,e.push(s),s}}]),e}();Tt.currentThread=void 0;var Ct=function(){function e(t){var a=this;Object(h.a)(this,e),this.cpuUsages=[],this.threadDumps=[],this.filesToParse=0,this.parsingStarted=Date.now(),this.onFilesParsed=void 0,this.parseFiles=function(e){a.parsingStarted=Date.now(),a.cpuUsages=[],a.threadDumps=[],a.filesToParse=0,a.parse(e)},this.onParsedCpuUsage=function(e){a.cpuUsages.push(e),a.filesToParse=a.filesToParse-1,a.checkCompletion()},this.onParsedThreadDump=function(e){e.threads.length>0&&a.threadDumps.push(e),a.filesToParse=a.filesToParse-1,a.checkCompletion()},this.onFilesParsed=t}return Object(m.a)(e,[{key:"parse",value:function(e){1!==e.length||e[0].name.includes("cpu")?this.parseMultipleFiles(e):this.parseSingleFile(e[0])}},{key:"parseSingleFile",value:function(e){var t=this,a=new FileReader;a.onload=function(){for(var e=a.result.split("\n"),n=e.shift(),r=[];void 0!==n;)tt(dt,n)?(t.filesToParse++,Tt.parseThreadDump(r.slice(),t.onParsedThreadDump),r=[n]):r.push(n),n=e.shift();Tt.parseThreadDump(r,t.onParsedThreadDump)},this.filesToParse++,a.readAsText(e)}},{key:"parseMultipleFiles",value:function(e){var t=this;this.filesToParse=this.filesToParse+e.length;var a=!0,n=!1,r=void 0;try{for(var i,l=function(){var e=i.value,a=new FileReader;a.onload=function(){var e=a.result.split("\n"),n=e[0];n&&(tt(rt,n)?ht.parseCpuUsage(e,t.onParsedCpuUsage):tt(dt,n)?Tt.parseThreadDump(e,t.onParsedThreadDump):t.filesToParse=t.filesToParse-1)},a.readAsText(e)},o=e[Symbol.iterator]();!(a=(i=o.next()).done);a=!0)l()}catch(c){n=!0,r=c}finally{try{a||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"checkCompletion",value:function(){this.filesToParse||(this.fireAnalytics(),this.groupCpuUsagesWithThreadDumps(),this.sortThreadDumps(),this.onFilesParsed(this.threadDumps))}},{key:"fireAnalytics",value:function(){c.b.timing({category:"Parsing",value:Date.now()-this.parsingStarted,variable:"parsed-all"}),c.b.event({action:"Loaded CPU usages",category:"Parsing",value:this.cpuUsages.length}),c.b.event({action:"Loaded thread dumps",category:"Parsing",value:this.threadDumps.length})}},{key:"groupCpuUsagesWithThreadDumps",value:function(){var e=this;this.cpuUsages.filter(function(e){return e.getEpoch()}).forEach(function(t){var a=e.findCorrespondingThreadDump(t);e.groupCpuUsageWithThreadDump(a,t)})}},{key:"sortThreadDumps",value:function(){this.threadDumps.sort(function(e,t){return e.getEpoch()===t.getEpoch()?0:e.getEpoch()?t.getEpoch()?e.getEpoch()-t.getEpoch():1:-1})}},{key:"findCorrespondingThreadDump",value:function(e){var t=e.getEpoch(),a=null,n=1e4;return this.threadDumps.filter(function(e){return e.getEpoch()}).forEach(function(e){var r=e.getEpoch();if(r&&t){var i=Math.abs(r%36e5-t%36e5);i<n&&(n=i,a=e)}}),null==a&&(a=new te(null),this.threadDumps.push(a)),a}},{key:"groupCpuUsageWithThreadDump",value:function(e,t){var a=this;e.loadAverages=t.loadAverages,e.runningProcesses=t.runningProcesses,e.memoryUsage=t.memoryUsage,t.threadCpuUsages.forEach(function(t){var n=a.findThreadWithId(e,t.id);n&&(n.cpuUsage=t.cpuUsage,n.runningFor=t.runningFor)})}},{key:"findThreadWithId",value:function(e,t){var a=!0,n=!1,r=void 0;try{for(var i,l=e.threads[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var o=i.value;if(o.id===t)return o}}catch(c){n=!0,r=c}finally{try{a||null==l.return||l.return()}finally{if(n)throw r}}return null}}]),e}(),Dt=function(e){e.stopPropagation()},St=function(){return i.a.createElement("div",{id:"dropzone-guide",onClick:Dt},i.a.createElement("h6",{dangerouslySetInnerHTML:{__html:"For the full experience, you should gather thread dumps along with <i>top</i> outputs."}}),i.a.createElement("span",null,"See: ",i.a.createElement(c.a,{eventLabel:"Gathering data",to:"https://github.com/drauf/watson/blob/master/README.md#gathering-thread-dumps",target:"_blank"},"How to gather data")),i.a.createElement("p",{dangerouslySetInnerHTML:{__html:"Watson works fully offline. No files will leave your machine."}}),i.a.createElement("ul",{id:"dropzone-links"},i.a.createElement("li",null,i.a.createElement(c.a,{eventLabel:"Issue tracker",to:"https://github.com/drauf/watson/issues",target:"_blank"},"Issue tracker")),i.a.createElement("li",null,i.a.createElement(c.a,{eventLabel:"Source code",to:"https://github.com/drauf/watson",target:"_blank"},"Source code"))))},jt=(a(394),function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).render=function(){return i.a.createElement(qe.a,{multiple:!0,onDrop:a.onDrop},function(e){var t=e.getRootProps,a=e.getInputProps,n=e.isDragActive;return i.a.createElement("div",Object.assign({id:"dropzone"},t()),i.a.createElement("input",a()),n?i.a.createElement("h4",null,"Drop files here..."):i.a.createElement("h4",null,"Drop the catalog here, or click to select files to load."),i.a.createElement(St,null))})},a.onDrop=function(e){new Ct(a.onParsed).parseFiles(e)},a.onParsed=function(e){var t=S(e);e.some(function(e){return!!e.loadAverages})?a.props.history.push("/".concat(t,"/summary/")):a.props.history.push("/".concat(t,"/similar-stacks/"))},a}return Object(f.a)(t,e),t}(i.a.PureComponent)),Nt=Object(u.e)(jt),Ft=function(){return i.a.createElement(u.c,null,i.a.createElement(u.a,{exact:!0,path:"/",component:Nt}),i.a.createElement(u.a,{path:"/:key",component:Qe}))},xt=a(166);a(395);c.b.initialize("UA-134928161-1",{gaOptions:{siteSpeedSampleRate:100}}),function(){var e=(new Date).setDate((new Date).getDate()-7);T.iterate(function(t,a){t<e&&(C.removeItem(a),T.removeItem(a))})}(),o.a.render(i.a.createElement(s.a,null,i.a.createElement(u.a,{component:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(a){return Object(r.useEffect)(function(){var e;e=a.location.pathname,c.b.set(Object(xt.a)({page:e},t)),c.b.pageview(e)},[a.location.pathname]),i.a.createElement(e,a)}}(Ft,{})})),document.getElementById("root"))}},[[190,1,2]]]);
//# sourceMappingURL=main.5589dc35.chunk.js.map